<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="SSH,hibernate," />





  <link rel="alternate" href="/atom.xml" title="geekhoon" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="概述1.ORM(Object Relation Mapping):对象关系映射.  作用: 通过对象与表之间的关系映射,动态生成SQL语句,从而达到操作对象即完成对表的操作2.hibernate: Dao(持久层)的ORM框架  作用:通过对象与表之间的关系映射,动态生成SQL语句,从而达到操作对象即完成对表的操作 – 操作实体类就相当于操作数据库表">
<meta property="og:type" content="article">
<meta property="og:title" content="hibernate">
<meta property="og:url" content="https://geekhoon.github.io/2017/05/09/hibernate/index.html">
<meta property="og:site_name" content="geekhoon">
<meta property="og:description" content="概述1.ORM(Object Relation Mapping):对象关系映射.  作用: 通过对象与表之间的关系映射,动态生成SQL语句,从而达到操作对象即完成对表的操作2.hibernate: Dao(持久层)的ORM框架  作用:通过对象与表之间的关系映射,动态生成SQL语句,从而达到操作对象即完成对表的操作 – 操作实体类就相当于操作数据库表">
<meta property="og:image" content="http://oj3s07yy0.bkt.clouddn.com/blog/20170511/234219931.png">
<meta property="og:image" content="http://oj3s07yy0.bkt.clouddn.com/blog/20170511/234309837.png">
<meta property="og:image" content="http://oj3s07yy0.bkt.clouddn.com/blog/20170512/153031608.png">
<meta property="og:image" content="http://oj3s07yy0.bkt.clouddn.com/blog/20170512/154140899.png">
<meta property="og:image" content="http://oj3s07yy0.bkt.clouddn.com/blog/20170512/195911717.png">
<meta property="og:image" content="http://oj3s07yy0.bkt.clouddn.com/blog/20170512/200901955.png">
<meta property="og:updated_time" content="2017-05-12T13:56:51.426Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hibernate">
<meta name="twitter:description" content="概述1.ORM(Object Relation Mapping):对象关系映射.  作用: 通过对象与表之间的关系映射,动态生成SQL语句,从而达到操作对象即完成对表的操作2.hibernate: Dao(持久层)的ORM框架  作用:通过对象与表之间的关系映射,动态生成SQL语句,从而达到操作对象即完成对表的操作 – 操作实体类就相当于操作数据库表">
<meta name="twitter:image" content="http://oj3s07yy0.bkt.clouddn.com/blog/20170511/234219931.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6313944065398277000,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://geekhoon.github.io/2017/05/09/hibernate/"/>

  <title> hibernate | geekhoon </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0e415640295b545ca0e400dbf0b42e7e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>
   
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">geekhoon</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">怕, 你就输一辈子</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                hibernate
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-09T15:18:46+08:00" content="2017-05-09">
              2017-05-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SSH/" itemprop="url" rel="index">
                    <span itemprop="name">SSH</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/09/hibernate/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/05/09/hibernate/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/05/09/hibernate/" class="leancloud_visitors" data-flag-title="hibernate">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>1.ORM(Object Relation Mapping):对象关系映射.<br>  作用: 通过对象与表之间的关系映射,动态生成SQL语句,从而达到操作对象即完成对表的操作<br>2.hibernate: Dao(持久层)的ORM框架<br>  作用:通过对象与表之间的关系映射,动态生成SQL语句,从而达到操作对象即完成对表的操作 – 操作实体类就相当于操作数据库表<br><a id="more"></a></p>
<h2 id="hibernate框架搭建"><a href="#hibernate框架搭建" class="headerlink" title="hibernate框架搭建"></a>hibernate框架搭建</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>hibernate是Dao层的解决方案,故Web项目,Java项目皆可</p>
<h3 id="导jar包"><a href="#导jar包" class="headerlink" title="导jar包"></a>导jar包</h3><p>9个hibernate必须jar包,1个MYSQL驱动包</p>
<h3 id="创建数据库与表"><a href="#创建数据库与表" class="headerlink" title="创建数据库与表"></a>创建数据库与表</h3><h3 id="创建对应的实体类JavaBean"><a href="#创建对应的实体类JavaBean" class="headerlink" title="创建对应的实体类JavaBean"></a>创建对应的实体类JavaBean</h3><h3 id="创建映射配置文件"><a href="#创建映射配置文件" class="headerlink" title="创建映射配置文件"></a>创建映射配置文件</h3><p>位置: 和实体类同在domain包下(不是必须)<br>命名规范: 实体类名.hbm.xml(不是必须)<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">Customer.hbm.xml:</div><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="comment">&lt;!-- 引入约束 --&gt;</span></div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></div><div class="line">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</div><div class="line">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"><span class="comment">&lt;!-- </span></div><div class="line">    package:可以配置包名;</div><div class="line">	如:&lt;hibernate-mapping package="com.geekhoon.domain"&gt;</div><div class="line">	配置包名后,后面凡是需要完整类名的地方,都可以省略包名</div><div class="line"> --&gt;</div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- </span></div><div class="line">		class:映射类与表的关系</div><div class="line">        name:类的全限定名;(如果配置了package,直接写实体类名)</div><div class="line">        table:类对应的表名;</div><div class="line">     --&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.geekhoon.domain.Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- </span></div><div class="line">			id:映射主键属性名(OID)与主键列对应关系</div><div class="line">            name:主键在类中的属性名(OID名称);</div><div class="line">            column:主键在表中的字段名;</div><div class="line">            length:设置字段的长度(不写默认数据库对应列长度);</div><div class="line">            type:设置字段的类型</div><div class="line">                type="long"                                           hibernate类型</div><div class="line">                type="java.lang.Long"                                 java类型</div><div class="line">                &lt;column name="cust_id" sql-type="bigint"&gt;&lt;/column&gt;    数据库类型</div><div class="line"></div><div class="line">            注:当name值与column值相同,可以省略column;</div><div class="line">         --&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"cust_id"</span>&gt;</span></div><div class="line"></div><div class="line">            <span class="comment">&lt;!-- </span></div><div class="line">                用于描述主键的生成策略:</div><div class="line">                    native表示主键自动增长(int,Integer,long);</div><div class="line">             --&gt;</div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- </span></div><div class="line">			property:映射非主键属性名与非主键列对应关系</div><div class="line">            name:属性名;</div><div class="line">            column:属性名对应表中的字段名;</div><div class="line">            注:当name值与column值相同,可以省略column;</div><div class="line">         --&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="创建hibernate主配置"><a href="#创建hibernate主配置" class="headerlink" title="创建hibernate主配置"></a>创建hibernate主配置</h3><p>位置: src下<br>命名规范: hibernate.cfg.xml(固定写法)<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></div><div class="line">			</div><div class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 1. 必选配置:数据库基本信息 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///hibernate01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 数据库方言:</span></div><div class="line">			所有数据库的sql语句都是基于SQL99标准的,每种数据库在此基础上会有部分扩充,称为方言</div><div class="line">			这里是MySQL --&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 2. 可选配置:hibernate配置 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 是否在控制台打印SQL语句 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 是否对控制台显示的SQL语句进行格式化 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 建表方式</span></div><div class="line">			create(测试时使用):没有表,建表.有表,删原表建新表;</div><div class="line">			create-drop(测试时使用):启动hibernate时建表,释放资源时删表;</div><div class="line">			update(常用):没有表,建表.有表,可更新表结构;</div><div class="line">			validate:不会自动建表,每次启动都会校验表结构;</div><div class="line">		 --&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 3. 重要:加载映射文件 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 相对应src目录下的位置 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/geekhoon/domain/Customer.hbm.xml"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><p>注意:增加操作不需要查,删除和更改都有两种方式,不先查的话会有缺点<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 增 CRUD之C</div><div class="line">	 * create</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//通过工具类获得session对象</span></div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//获取事务对象,并开启事务</span></div><div class="line">		Transaction tx = session.beginTransaction();</div><div class="line">		<span class="comment">//操作数据库</span></div><div class="line">		Customer c = <span class="keyword">new</span> Customer();</div><div class="line">		c.setCust_name(<span class="string">"wahaha"</span>);</div><div class="line">		session.save(c);</div><div class="line">		<span class="comment">//提交事务</span></div><div class="line">		tx.commit();</div><div class="line">		<span class="comment">//释放资源</span></div><div class="line">		session.close();</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 删 CRUD之D</div><div class="line">	 * delete</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		Transaction tx = session.beginTransaction();</div><div class="line">		<span class="comment">/*</span></div><div class="line">		 * 方式1:先查后删</div><div class="line">		 */</div><div class="line">		Customer customer = session.get(Customer.class, <span class="number">3L</span>);</div><div class="line">		<span class="comment">/*</span></div><div class="line">		 * 方式2:不查,直接new一个对象,但是要设置被删对象的id</div><div class="line">		 *  Customer customer = new Customer();</div><div class="line">			customer.setCust_id(4L);</div><div class="line">缺点:不能完成级联删除(多表之间,存在外键,不能随意删除,先删主表(主表的主键是从表的外键),才能删从表(包含外键的表))</div><div class="line">		 */</div><div class="line">		</div><div class="line">		</div><div class="line">		session.delete(customer);</div><div class="line">		tx.commit();</div><div class="line">		session.close();</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 改 CRUD之U</div><div class="line">	 * update</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		Transaction tx = session.beginTransaction();</div><div class="line">		<span class="comment">/*</span></div><div class="line">		 * 方式1:先查后改</div><div class="line">		 */</div><div class="line">		<span class="comment">/*Customer customer = session.get(Customer.class, 1L);</span></div><div class="line">		customer.setCust_name("gggggggggg");*/</div><div class="line">		</div><div class="line">		<span class="comment">/*</span></div><div class="line">		 * 方式2:不查,new一个对象,需要设置id</div><div class="line">缺点: 除了设置的name列:setCust_name有值"geek",其他列被全部置为null</div><div class="line">		 * 方式1不存在此问题</div><div class="line">		 */</div><div class="line">		Customer customer = <span class="keyword">new</span> Customer();</div><div class="line">		customer.setCust_id(<span class="number">1L</span>);</div><div class="line">		customer.setCust_name(<span class="string">"geek"</span>);</div><div class="line">		</div><div class="line">		session.update(customer);</div><div class="line">		tx.commit();</div><div class="line">		session.close();</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 查 CRUD之R</div><div class="line">	 * read</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		Transaction tx = session.beginTransaction();</div><div class="line">		</div><div class="line">		Customer customer = session.get(Customer.class, <span class="number">1L</span>);</div><div class="line">		System.out.println(customer);</div><div class="line">		tx.commit();</div><div class="line">		session.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">作用：</div><div class="line">	用于加载主配置文件;</div><div class="line">常用方法:</div><div class="line">	构造:</div><div class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</div><div class="line">	其它:</div><div class="line">		conf.configure(); <span class="comment">// 加载src下的主配置文件;</span></div><div class="line">		buildSessionFactory(); <span class="comment">// 根据主配置文件,构建SessionFactory;</span></div><div class="line">通常写法:</div><div class="line">	Configuration conf = <span class="keyword">new</span> Configuration().configure();</div></pre></td></tr></table></figure>
<h3 id="SessionFactory"><a href="#SessionFactory" class="headerlink" title="SessionFactory"></a>SessionFactory</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">作用:</div><div class="line">	session对象的工厂对象,用于创建Session;</div><div class="line">常用方法:</div><div class="line">	创建:</div><div class="line">		conf.buildSessionFactory(); <span class="comment">// 根据主配置文件,构建SessionFactory;</span></div><div class="line">	获得session:</div><div class="line">		openSession(); <span class="comment">// 获取普通Session;</span></div><div class="line">		getCurrentSession(); <span class="comment">// 获取与线程绑定的Session;</span></div><div class="line">	特性:</div><div class="line">		<span class="number">1</span>. 其创建和销毁会消耗很多资源(内存);</div><div class="line">		<span class="number">2</span>. 一个线程安全的对象,所有由该工厂生产的Session都共享工厂中维护的数据;</div><div class="line">		<span class="number">3</span>. 其内部维护了很多的信息:</div><div class="line">			a. 连接数据库的信息</div><div class="line">	  		b. hibernate的基本配置</div><div class="line">	  		c. 映射文件的位置,以及映射文件中的配置;</div><div class="line">	  		d. 一些预定义的SQL语句（这些语句都是通用的）</div><div class="line">			e. hibernate的二级缓存</div><div class="line">原则就是：</div><div class="line">	一个应用应该只有一个SessionFactory.在应用加载时创建,应用卸载时销毁.</div><div class="line">写法:</div><div class="line">	<span class="comment">//创建SessionFactory</span></div><div class="line">	SessionFactory sf = conf.buildSessionFactory();</div><div class="line">	<span class="comment">//创建Session</span></div><div class="line">	Session session = sf.openSession();</div></pre></td></tr></table></figure>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">作用：</div><div class="line">	用于跟数据库交互.包含了增删改查(CRUD)以及获取事务对象.</div><div class="line">常用方法:</div><div class="line">	创建:</div><div class="line">		SessionFactory.openSession(); <span class="comment">// 获取普通Session;</span></div><div class="line">		SessionFactory.getCurrentSession(); <span class="comment">// 获取与线程绑定的Session;</span></div><div class="line">	其它:</div><div class="line">		save(Object entity); <span class="comment">// 保存一个实体到数据库;</span></div><div class="line">	  	update(Object entity); <span class="comment">// 更新一个实体;</span></div><div class="line">	  	delete(Object entity); <span class="comment">// 删除一个实体;(自己创建对象时不能完成级联删除)</span></div><div class="line">	  	get(Class clazz,Serializable id); </div><div class="line">		<span class="comment">// 根据id查询一个实体.参数的含义:Class表示要查询的实体类字节码,Serializable就是查询的条件,即ID值;</span></div><div class="line">	  	</div><div class="line">		beginTransaction(); <span class="comment">// 开启事务,并返回事务对象;</span></div></pre></td></tr></table></figure>
<h3 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">作用:</div><div class="line">	用于控制事务;</div><div class="line">常用方法:</div><div class="line">	创建:</div><div class="line">		Session.beginTransaction(); <span class="comment">// 开启事务,并返回事务对象;</span></div><div class="line"></div><div class="line">	其它:</div><div class="line">		commit(); <span class="comment">// 提交事务;</span></div><div class="line">	  	rollback(); <span class="comment">// 回滚事务;</span></div></pre></td></tr></table></figure>
<h2 id="HibernateUtils工具类"><a href="#HibernateUtils工具类" class="headerlink" title="HibernateUtils工具类"></a>HibernateUtils工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SessionFactory sessionFactory;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 使用原则</div><div class="line">	 * 	一个应用应该只有一个SessionFactory.在应用加载时创建,应用卸载时销毁.</div><div class="line">	 */</div><div class="line">	<span class="keyword">static</span> &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//加载配置文件</span></div><div class="line">			Configuration conf = <span class="keyword">new</span> Configuration().configure();</div><div class="line">			<span class="comment">//生成sessionFactory</span></div><div class="line">			sessionFactory = conf.buildSessionFactory();</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ExceptionInInitializerError(<span class="string">"初始化SessionFactory失败"</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 获取Session;</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">openSession</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> sessionFactory.openSession();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="持久化类"><a href="#持久化类" class="headerlink" title="持久化类"></a>持久化类</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>与数据库表建立了映射关系的JavaBean</p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>实现通过操作持久化类完成对数据库表的操作</p>
<h3 id="编写规则"><a href="#编写规则" class="headerlink" title="编写规则"></a>编写规则</h3><p>1.提供无参构造<br>2.提供唯一标识OID与表的主键对应<br>3.提供私有属性,并为私有属性提供公共的getter/setter方法<br>4.属性的类型使用包装类型<br>5.不要使用final修饰</p>
<h3 id="持久化类的状态"><a href="#持久化类的状态" class="headerlink" title="持久化类的状态"></a>持久化类的状态</h3><p>1.瞬时态: 无OID,与Hibernate Session无关联<br>2.持久态: 有OID,与Hibernate Session关联<br>3.游离态/托管态: 有OID,与Hibernate Session无关联</p>
<h4 id="三种状态及转化"><a href="#三种状态及转化" class="headerlink" title="三种状态及转化"></a>三种状态及转化</h4><p><img src="http://oj3s07yy0.bkt.clouddn.com/blog/20170511/234219931.png" alt="mark"><br><img src="http://oj3s07yy0.bkt.clouddn.com/blog/20170511/234309837.png" alt="mark"><br>1.hibernate框架的功能就是对数据进行持久化操作<br>2.持久态对象,会在session提交时,自动与数据库同步<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">根据<span class="number">2</span>,提交时,会自动更新数据库,所以执行完<span class="number">1</span>和<span class="number">2</span>后,<span class="number">3</span>的update可以省略不写</div><div class="line">Customer customer = session.get(Customer.class, <span class="number">1L</span>);<span class="comment">//1</span></div><div class="line">customer.setCust_name(<span class="string">"gggggggggg"</span>);<span class="comment">//2</span></div><div class="line"></div><div class="line">session.update(customer);<span class="comment">//3</span></div><div class="line">tx.commit();</div><div class="line">session.close();</div></pre></td></tr></table></figure></p>
<h3 id="saveOrUpdate方法"><a href="#saveOrUpdate方法" class="headerlink" title="saveOrUpdate方法"></a>saveOrUpdate方法</h3><p>会自动根据对象状态(判断依据是id值,id为null代表瞬时态;id不为null代表游离态),完成save或update操作,对象是瞬时态时,执行save;对象是游离态时,执行update.</p>
<h2 id="主键生成策略"><a href="#主键生成策略" class="headerlink" title="主键生成策略"></a>主键生成策略</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;generator class=&quot;native&quot;&gt;&lt;/generator&gt;</div><div class="line">1. 主键类型:</div><div class="line">	- 自然主键</div><div class="line">		主键具有业务含义的字段;</div><div class="line">	- 代理主键</div><div class="line">		主键不具有业务含义的字段;</div><div class="line"></div><div class="line">2. 主键生成策略:</div><div class="line">	- identity(常用)</div><div class="line">		主键自增,有数据库负责主键生成;</div><div class="line">	- sequence</div><div class="line">		序列,Oracle时使用;</div><div class="line">	- hilo(用不着)</div><div class="line">		高低位算法,适用于既不支持自增也不支持序列,但还想实现主键自增效果的数据库;</div><div class="line">	- native(常用)</div><div class="line">		自动根据数据库提供的主键自增来选择使用identity,sequence,hilo;</div><div class="line">	- increment</div><div class="line">		hibernate每次插入之前先查询表中OID的最大值,在最大值基础上+1作为新的主键;</div><div class="line">	- uuid</div><div class="line">		主键类型为字符串时使用,自动使用UUID随机生成字符串作为主键;</div><div class="line">	- assigned</div><div class="line">		由程序员手动指定OID值;</div></pre></td></tr></table></figure>
<h2 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>hibernate的一级缓存就是指Session缓存,Session缓存就是一块内存空间(Map),用来存放持久态JavaBean</p>
<h3 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h3><p>减少对数据库的访问次数</p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p>在使用hibernate查询对象的时候,首先hibernate会使用对象属性的OID值在hibernate的一级缓存中进行查找:<br>如果没有找到相同OID值的对象,则会生成对应sql语句,去数据库中查找相应数据.当从数据库中查询到所需数据时,会将数据信息封装成对象放置到一级缓存中.<br>如果找到相同OID值的对象,就直接将该对象从一级缓存中取出使用,不生成sql语句,不会再查询数据库.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Customer c1 = session.get(Customer.class, <span class="number">1l</span>);<span class="comment">//执行SQL</span></div><div class="line">		</div><div class="line">Customer c2 = session.get(Customer.class, <span class="number">1l</span>);<span class="comment">//没有执行SQL</span></div><div class="line"></div><div class="line">System.out.println(c1==c2);<span class="comment">//true</span></div></pre></td></tr></table></figure></p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>1.当调用Session接口的save(),update(),saveOrUpdate()方法时,若Session缓存中没有相应的对象,hibernate会自动将当前操作的对象信息存放到hibernate的一级缓存中.<br>2.当调用Session接口的load(),get()方法,以及Query接口的list(),iterator()方法时,会判断缓存中是否存在该对象,有则返回,不会查询数据库.如果缓存中没有要查询对象,再去数据库中查询对应对象,并存放到一级缓存中.<br>3.当调用Session接口的close()方法时,Session缓存会被清空.</p>
<h3 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h3><p>使用hibernate查询对象时,一级缓存中没有相同的OID值的对象,会查询数据库,并将查询到的数据封装成对象,一式两份分别存放在一级缓存和快照中,然后一级缓存中的对象会被返回给程序,程序对对象属性进行修改(修改的就是一级缓存中的对象属性),当事务提交时,hibernate会自动对缓存中的数据与快照中的数据进行比对,如不一致将执行update.如一致,则不做操作</p>
<h2 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">1. 是什么</div><div class="line">	逻辑上的一组操作,要么都成功,要么都失败;</div><div class="line"></div><div class="line">2.  特性</div><div class="line">	- (A)原子性:</div><div class="line">		逻辑上的一组操作,要么都成功,要么都失败;</div><div class="line">	- (C)一致性:</div><div class="line">		事务完成后,所有的数据必须符合业务逻辑,否则要回滚;</div><div class="line">	- (I)隔离性:</div><div class="line">		事务之间相互隔离;</div><div class="line">	- (D)持久性:</div><div class="line">		事务提交后,数据持久化到数据库中;</div><div class="line"></div><div class="line">3.  事务并发问题</div><div class="line">	- 脏读:</div><div class="line">		一个事务读取到另一个事务未提交的事务;</div><div class="line">	- 不可重复读:</div><div class="line">		一个事务中两次查询的数据不一致   --&gt;(update);</div><div class="line">	- 虚读(幻读):</div><div class="line">		一个事务中两次查询的数据不一致   --&gt;(insert);</div><div class="line"></div><div class="line">4.  事务的隔离级别</div><div class="line">	- 8 (串行化)serializable:</div><div class="line">		解决脏读,不可重复读,虚读(幻读)问题;</div><div class="line">	- 4 (可重复读)repeatable read(默认隔离级别):</div><div class="line">		解决脏读,不可重复读问题;</div><div class="line">	- 2 (读已提交)read committed:</div><div class="line">		解决脏读问题;</div><div class="line">	- 1 (读未提交)read uncommitted:</div><div class="line">		未解决任何问题;</div><div class="line"></div><div class="line">5.  在hibernate设置事务隔离级别(hibernate.cfg.xml)</div><div class="line">	&lt;!-- </div><div class="line">		设置事务的隔离级别</div><div class="line">			MySQL默认事务隔离级别为4;</div><div class="line">			Oracle默认事务隔离级别为2;</div><div class="line">	 --&gt;</div><div class="line">	&lt;property name=&quot;hibernate.connection.isolation&quot;&gt;4&lt;/property&gt;</div><div class="line">	&lt;!-- 配置Session与当前线程绑定 --&gt;</div><div class="line">	&lt;property name=&quot;hibernate.current_session_context_class&quot;&gt;thread&lt;/property&gt;</div></pre></td></tr></table></figure>
<h3 id="项目中事务管理"><a href="#项目中事务管理" class="headerlink" title="项目中事务管理"></a>项目中事务管理</h3><p>在项目中,service层负责开启事务,执行业务以及关闭事务,dao层负责CRUD操作,需要保证service层和dao层使用的是同一个session对象,需要使用ThreadLocal,但是不用自己写,hibernate已经封装好了,通过调用sessionFactory.getCurrentSession()可以获得从ThreadLocal中获得与当前线程绑定的session.<br><strong>使用getCurrentSession方法的注意事项:</strong><br>1.必须配合配置才能调用该方法,如果没有配置,调用会报错<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置Session与当前线程绑定 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>2.getCurrentSession获得的session对象在事务提交时自动关闭,不要再调用session的close()<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">service层管理事务:</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> CustomerDao dao = <span class="keyword">new</span> CustomerDaoImPl();</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer c)</span> </span>&#123;</div><div class="line">		<span class="comment">//开启事务</span></div><div class="line">		HibernateUtils.getCurrentSession().beginTransaction();</div><div class="line">		<span class="comment">//调用dao,执行业务</span></div><div class="line">		dao.save(c);</div><div class="line">		<span class="comment">//关闭事务</span></div><div class="line">		HibernateUtils.getCurrentSession().getTransaction().commit();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">Dao层获得当前线程对应的Session操作数据库:</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoImPl</span> <span class="keyword">implements</span> <span class="title">CustomerDao</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer c)</span> </span>&#123;</div><div class="line">		</div><div class="line">		Session session = HibernateUtils.getCurrentSession();</div><div class="line">		session.save(c);</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="hibernate查询API"><a href="#hibernate查询API" class="headerlink" title="hibernate查询API"></a>hibernate查询API</h2><h3 id="HQL查询"><a href="#HQL查询" class="headerlink" title="HQL查询"></a>HQL查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HQL</span> </span>&#123;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 查询所有</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.写HQL语句</span></div><div class="line">		String hql = <span class="string">"from Customer"</span>;</div><div class="line">		<span class="comment">//2.创建HQL查询对象</span></div><div class="line">		Query query = session.createQuery(hql);</div><div class="line">		<span class="comment">//3.执行查询</span></div><div class="line">		List&lt;Customer&gt; list = query.list();</div><div class="line">		</div><div class="line">		System.out.println(list);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 条件查询</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.写HQL语句</span></div><div class="line">		String hql = <span class="string">"from Customer where cust_name like ?"</span>;</div><div class="line">		<span class="comment">//2.创建HQL查询对象</span></div><div class="line">		Query query = session.createQuery(hql);</div><div class="line">		</div><div class="line">		<span class="comment">//0代表占位符位置,从0开始</span></div><div class="line">		query.setParameter(<span class="number">0</span>, <span class="string">"%geek%"</span>);</div><div class="line">		<span class="comment">//3.执行查询</span></div><div class="line">		<span class="comment">//返回结果是多个,用list()</span></div><div class="line">		<span class="comment">//List&lt;Customer&gt; list = query.list();</span></div><div class="line">		<span class="comment">//返回结果是一个,用uniqueResult()</span></div><div class="line">		Customer customer = (Customer) query.uniqueResult();</div><div class="line">		System.out.println(customer);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 分页查询 </div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.写HQL语句</span></div><div class="line">		String hql = <span class="string">"from Customer"</span>;</div><div class="line">		<span class="comment">//2.创建HQL查询对象</span></div><div class="line">		Query query = session.createQuery(hql);</div><div class="line">		</div><div class="line">		query.setFirstResult(<span class="number">2</span>);<span class="comment">// 设置查询开始索引; --&gt; startIndex</span></div><div class="line">		query.setMaxResults(<span class="number">2</span>);<span class="comment">// 设置一次查询几条记录; --&gt; pageSize</span></div><div class="line">		</div><div class="line">		<span class="comment">//3.执行查询</span></div><div class="line">		List&lt;Customer&gt; list = query.list();</div><div class="line">		<span class="comment">//Customer customer = (Customer) query.uniqueResult();</span></div><div class="line">		System.out.println(list);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 统计查询 </div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.写HQL语句</span></div><div class="line">		String hql = <span class="string">"select count(*) from Customer"</span>;</div><div class="line">		<span class="comment">//2.创建HQL查询对象</span></div><div class="line">		Query query = session.createQuery(hql);</div><div class="line">		</div><div class="line">		<span class="comment">//3.执行查询</span></div><div class="line">		Long rows = (Long) query.uniqueResult();</div><div class="line">		System.out.println(rows);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Criteria查询-QBC查询"><a href="#Criteria查询-QBC查询" class="headerlink" title="Criteria查询(QBC查询)"></a>Criteria查询(QBC查询)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QBC</span> </span>&#123;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 查询所有</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.创建查询对象</span></div><div class="line">		Criteria criteria = session.createCriteria(Customer.class);</div><div class="line">		<span class="comment">//2.执行查询</span></div><div class="line">		List list = criteria.list();</div><div class="line">		System.out.println(list);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 条件查询</div><div class="line">	 * 常用:</div><div class="line">            短语      |   含义</div><div class="line">        Restrictions.eq     |    =</div><div class="line">        Restrictions.gt     |    &gt;</div><div class="line">        Restrictions.ge     |    &gt;=</div><div class="line">        Restrictions.lt     |    &lt; </div><div class="line">        Restrictions.le     |    &lt;= </div><div class="line">        Restrictions.between|   between</div><div class="line">        Restrictions.like   |    like</div><div class="line">        Restrictions.in     |    in</div><div class="line">        Restrictions.and    |    and</div><div class="line">        Restrictions.or     |    or</div><div class="line">        Restrictions.asc()  |    asc</div><div class="line">        Restrictions.desc() |    desc</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.创建查询对象</span></div><div class="line">		Criteria criteria = session.createCriteria(Customer.class);</div><div class="line">		<span class="comment">//2.指定查询条件</span></div><div class="line">		<span class="comment">/*</span></div><div class="line">		 * 一个条件</div><div class="line">		 */</div><div class="line">		<span class="comment">//criteria.add(Restrictions.like("cust_name", "%1%"));</span></div><div class="line">		<span class="comment">/*</span></div><div class="line">		 * 多个条件</div><div class="line">		 */</div><div class="line">		criteria.add(Restrictions.and(</div><div class="line">				Restrictions.like(<span class="string">"cust_name"</span>, <span class="string">"%1%"</span>),</div><div class="line">				Restrictions.eq(<span class="string">"cust_phone"</span>, <span class="string">"110"</span>)</div><div class="line">				));</div><div class="line">		<span class="comment">//Customer result = (Customer) criteria.uniqueResult();//查询一个结果</span></div><div class="line">		List&lt;Customer&gt; list = criteria.list();<span class="comment">//查询多个结果</span></div><div class="line">		System.out.println(list);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 分页查询</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.获取查询对象</span></div><div class="line">		Criteria criteria = session.createCriteria(Customer.class);</div><div class="line">		<span class="comment">//2.设置分页参数</span></div><div class="line">		criteria.setFirstResult(<span class="number">0</span>);<span class="comment">//startIndex</span></div><div class="line">		criteria.setMaxResults(<span class="number">2</span>);<span class="comment">//pageSize</span></div><div class="line">		<span class="comment">//3.执行查询</span></div><div class="line">		List&lt;Customer&gt; list = criteria.list();</div><div class="line">		System.out.println(list);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 排序查询</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.获取查询对象</span></div><div class="line">		Criteria criteria = session.createCriteria(Customer.class);</div><div class="line">		<span class="comment">//2.设置排序条件</span></div><div class="line">		<span class="comment">//根据id升序/降序</span></div><div class="line">		<span class="comment">//criteria.addOrder(Order.asc("cust_id"));</span></div><div class="line">		criteria.addOrder(Order.desc(<span class="string">"cust_id"</span>));</div><div class="line">		<span class="comment">//3.执行查询</span></div><div class="line">		List&lt;Customer&gt; list = criteria.list();</div><div class="line">		System.out.println(list);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="原生SQL查询"><a href="#原生SQL查询" class="headerlink" title="原生SQL查询"></a>原生SQL查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SQLTest</span> </span>&#123;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 查询所有</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.编写sql语句</span></div><div class="line">		String sql = <span class="string">"select * from cst_customer"</span>;</div><div class="line">		<span class="comment">//2.封装查询对象</span></div><div class="line">		SQLQuery query = session.createSQLQuery(sql);</div><div class="line">		<span class="comment">//3.指定实例(告诉hibernate将结果封装到哪个对象中)</span></div><div class="line">		query.addEntity(Customer.class);</div><div class="line">		<span class="comment">//4.执行查询</span></div><div class="line">		List&lt;Customer&gt; list = query.list();</div><div class="line">		</div><div class="line">		System.out.println(list);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 条件查询</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.编写sql语句</span></div><div class="line">		String sql = <span class="string">"select * from cst_customer where cust_name like ?"</span>;</div><div class="line">		<span class="comment">//2.封装查询对象</span></div><div class="line">		SQLQuery query = session.createSQLQuery(sql);</div><div class="line">		<span class="comment">//3.指定参数占位符的值</span></div><div class="line">		query.setParameter(<span class="number">0</span>, <span class="string">"%geek%"</span>);</div><div class="line">		<span class="comment">//4.指定实例</span></div><div class="line">		query.addEntity(Customer.class);</div><div class="line">		<span class="comment">//5.执行查询</span></div><div class="line">		Customer result = (Customer)query.uniqueResult();</div><div class="line">		</div><div class="line">		System.out.println(result);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 统计查询</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.编写sql</span></div><div class="line">		String sql = <span class="string">"select count(*) from cst_customer"</span>;</div><div class="line">		<span class="comment">//2.封装查询对象</span></div><div class="line">		SQLQuery query = session.createSQLQuery(sql);</div><div class="line">		<span class="comment">//3.执行查询</span></div><div class="line">		BigInteger rows = (BigInteger) query.uniqueResult();</div><div class="line">		</div><div class="line">		System.out.println(rows);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 分页查询</div><div class="line">	 */</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		<span class="comment">//1.编写sql</span></div><div class="line">		String sql = <span class="string">"select * from cst_customer limit ? , ?"</span>;</div><div class="line">		<span class="comment">//2.封装查询对象</span></div><div class="line">		SQLQuery query = session.createSQLQuery(sql);</div><div class="line">		<span class="comment">//3.指定参数占位符的值</span></div><div class="line">		query.setParameter(<span class="number">0</span>, <span class="number">0</span>);</div><div class="line">		query.setParameter(<span class="number">1</span>, <span class="number">2</span>);</div><div class="line">		<span class="comment">//4.指定实例</span></div><div class="line">		query.addEntity(Customer.class);</div><div class="line">		<span class="comment">//5.执行查询</span></div><div class="line">		List&lt;Customer&gt; list = query.list();</div><div class="line">		</div><div class="line">		System.out.println(list);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="实体关系"><a href="#实体关系" class="headerlink" title="实体关系"></a>实体关系</h2><h3 id="一对多-多对一"><a href="#一对多-多对一" class="headerlink" title="一对多|多对一"></a>一对多|多对一</h3><h4 id="ORM对象关系映射"><a href="#ORM对象关系映射" class="headerlink" title="ORM对象关系映射"></a>ORM对象关系映射</h4><p><strong>R 关系数据库</strong><br>客户表对应联系人表,客户表中的每一条记录都是一家公司,一家公司对应多个联系人<br><img src="http://oj3s07yy0.bkt.clouddn.com/blog/20170512/153031608.png" alt="mark"><br><strong>O 对象</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">一方:</div><div class="line">    在一方对象中使用Set集合存放多方对象;</div><div class="line">多方:</div><div class="line">    在多方对象中直接引用一方对象;\</div></pre></td></tr></table></figure></p>
<p><img src="http://oj3s07yy0.bkt.clouddn.com/blog/20170512/154140899.png" alt="mark"><br><strong>M 映射</strong><br>需要在各自的映射配置文件中,class标签下,进行配置,配置完后还需要在主配置文件中引入映射配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">一方:	在一方配置文件中配置set标签:</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"存放多方对象的集合变量名"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"一表在多表中的外键名"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"多方对象的全限定名"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMen"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 指定对应的外键 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 一对多,指定关联的类是LinkMan --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.geekhoon.domain.LinkMan"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line"></div><div class="line">多方:	在多方配置文件中配置many-to-one标签</div><div class="line"><span class="tag">&lt;<span class="name">many-to-one</span> </span></div><div class="line">	<span class="attr">name</span>=<span class="string">"一方对象在多方对象中引用的变量名"</span> </div><div class="line">	<span class="attr">class</span>=<span class="string">"一方对象的全限定名"</span> </div><div class="line">	<span class="attr">column</span>=<span class="string">"一表在多表中的外键名"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">many-to-one</span> </span></div><div class="line">	<span class="attr">name</span>=<span class="string">"customer"</span></div><div class="line">	<span class="attr">column</span>=<span class="string">"lkm_cust_id"</span></div><div class="line">	<span class="attr">class</span>=<span class="string">"com.geekhoon.domain.Customer"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="一对多中的操作"><a href="#一对多中的操作" class="headerlink" title="一对多中的操作"></a>一对多中的操作</h4><h5 id="级联操作"><a href="#级联操作" class="headerlink" title="级联操作"></a>级联操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">什么是级联: 当主控方执行保存,更新或删除操作时,其关联对象也执行相同的操作;</div><div class="line"></div><div class="line">什么是主控方:</div><div class="line">   例:保存客户级联保存关联联系人--主控方是:客户;</div><div class="line">   例:保存联系人级联保存关联客户--主控方是联系人;</div><div class="line"></div><div class="line">需要在映射配置中添加cascade属性.</div><div class="line">cascade级联操作属性:</div><div class="line">   save-update:级联保存-更新;</div><div class="line">   delete:级联删除;</div><div class="line">   all:级联保存-更新,删除;</div></pre></td></tr></table></figure>
<p><strong>级联添加</strong><br>一对多|多对一: 在一中添加了cascade属性后,下次再save或update时就可以简化代码,2处和3处就可以省略不写.但是如果现在只写2处和3处,不写1处,是不可以的.因为在多中没有配置cascade属性.也就是说,如果一中添加了cascade属性,就可以通过保存客户级联保存联系人.只有双方都添加了cascade属性,才可以彼此级联保存(都设置了后,就可以只写1或只写2,3)<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">一对多:</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMen"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 指定对应的外键 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 一对多,指定关联的类是LinkMan --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.geekhoon.domain.LinkMan"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">多对一:</div><div class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span></span></div><div class="line">	<span class="attr">column</span>=<span class="string">"lkm_cust_id"</span></div><div class="line">	<span class="attr">class</span>=<span class="string">"com.geekhoon.domain.Customer"</span></div><div class="line">	<span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="comment">//保存客户以及客户下的多个联系人</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</div><div class="line">	Session session = HibernateUtils.OpenSession();</div><div class="line">	<span class="comment">//开启事务</span></div><div class="line">	Transaction tx = session.beginTransaction();</div><div class="line">	<span class="comment">//操作------------------------</span></div><div class="line">	<span class="comment">//创建客户</span></div><div class="line">	Customer c = <span class="keyword">new</span> Customer();</div><div class="line">	c.setCust_name(<span class="string">"Alibaba"</span>);</div><div class="line">	<span class="comment">//创建联系人</span></div><div class="line">	LinkMan lm1 = <span class="keyword">new</span> LinkMan();</div><div class="line">	LinkMan lm2 = <span class="keyword">new</span> LinkMan();</div><div class="line">	</div><div class="line">	lm1.setLkm_name(<span class="string">"大黄"</span>);</div><div class="line">	lm2.setLkm_name(<span class="string">"二黄"</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//表达关系</span></div><div class="line">	<span class="comment">//一对多</span></div><div class="line">	c.getLinkMen().add(lm1);</div><div class="line">	c.getLinkMen().add(lm2);</div><div class="line">	<span class="comment">//多对一</span></div><div class="line">	lm1.setCustomer(c);</div><div class="line">	lm2.setCustomer(c);</div><div class="line">	</div><div class="line">	<span class="comment">//将客户以及联系人保存到数据库</span></div><div class="line">	session.save(c);<span class="comment">//1</span></div><div class="line">	session.save(lm1);<span class="comment">//2</span></div><div class="line">	session.save(lm2);<span class="comment">//3</span></div><div class="line">	</div><div class="line">	<span class="comment">//---------------------------</span></div><div class="line">	<span class="comment">//提交事务</span></div><div class="line">	tx.commit();</div><div class="line">	<span class="comment">//释放资源</span></div><div class="line">	session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>级联删除</strong><br>要求:通过删除联系人(多),级联删除客户(一)<br>只需要在多方的添加cascade,如下:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">many-to-one</span></span></div><div class="line">	<span class="attr">name</span>=<span class="string">"customer"</span></div><div class="line"> 	<span class="attr">column</span>=<span class="string">"lkm_cust_id"</span></div><div class="line"> 	<span class="attr">class</span>=<span class="string">"com.geekhoon.domain.Customer"</span></div><div class="line"> 	<span class="attr">cascade</span>=<span class="string">"delete"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>当前,联系人表中id为1和2的联系人,对应的客户id都为1,如果只执行1,联系人中id为1的记录被删除,客户表中id为1的记录也被删除,此时联系人表中id为2的记录中对应的客户id为null;如果1,2都执行,则联系人中id为1,2的字段都删除,客户中id为1的字段被删除<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="comment">//通过删除联系人,级联删除客户</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</div><div class="line">	Session session = HibernateUtils.OpenSession();</div><div class="line">	Transaction tx = session.beginTransaction();</div><div class="line">	<span class="comment">//操作-----------------------</span></div><div class="line">	<span class="comment">//获得要删除的联系人</span></div><div class="line">	LinkMan lm1 = session.get(LinkMan.class, <span class="number">1L</span>);</div><div class="line">	LinkMan lm2 = session.get(LinkMan.class, <span class="number">2L</span>);</div><div class="line">	</div><div class="line">	session.delete(lm1);<span class="comment">//1</span></div><div class="line">	session.delete(lm2);<span class="comment">//2</span></div><div class="line">	<span class="comment">//---------------------------</span></div><div class="line">	tx.commit();</div><div class="line">	session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意:级联操作简化了代码操作,但是在实际开发中,不推荐使用级联删除</p>
<h5 id="inverse"><a href="#inverse" class="headerlink" title="inverse"></a>inverse</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">inverse设置是否不维护关系:</div><div class="line">   true:不维护关系;</div><div class="line">   false:维护关系;</div><div class="line">注意: 外键列所在实体,无法放弃维护关系</div></pre></td></tr></table></figure>
<p>背景:在保存客户及级联的联系人操作中,保存了一条客户记录和级联的两条联系人记录,如果在保存时,同时表达了一对多和多对一的关系(代码如下),会出现一个问题:在控制台中打印的sql语句中,除了三条insert语句,还多了两条update语句,这是因为关系维护重复,多出的update语句是由一对多关系维护产生的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">表达关系:</div><div class="line"><span class="comment">//一对多</span></div><div class="line">c.getLinkMen().add(lm1);</div><div class="line">c.getLinkMen().add(lm2);</div><div class="line"><span class="comment">//多对一</span></div><div class="line">lm1.setCustomer(c);</div><div class="line">lm2.setCustomer(c);</div></pre></td></tr></table></figure></p>
<p>解决方案1:在代码书写上,只书写多对一关系维护代码,删除一对多关系维护代码.如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">表达关系:</div><div class="line"><span class="comment">//多对一</span></div><div class="line">lm1.setCustomer(c);</div><div class="line">lm2.setCustomer(c);</div></pre></td></tr></table></figure></p>
<p>解决方案2:在一的一方(客户)配置中添加inverse属性,设置为true,让Customer放弃维护关联关系,此时代码如下,还可以如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">表达关系:</div><div class="line"><span class="comment">//一对多</span></div><div class="line">c.getLinkMen().add(lm1);</div><div class="line">c.getLinkMen().add(lm2);</div><div class="line"><span class="comment">//多对一</span></div><div class="line">lm1.setCustomer(c);</div><div class="line">lm2.setCustomer(c);</div></pre></td></tr></table></figure></p>
<p>客户映射配置文件:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMen"</span> <span class="attr">inverse</span>=<span class="string">"true"</span> &gt;</span></div><div class="line">	<span class="comment">&lt;!-- 指定对应的外键 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 一对多,指定关联的类是LinkMan --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.geekhoon.domain.LinkMan"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>结论:一对多多对一关系中,为了避免sql语句冗余.一般会在一的一方将inverse属性设置为true. 让一的一方放弃维护关联关系,. 所有维护关系的操作,都通过多的一方来完成</p>
<h5 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h5><p><em>删除关系</em>：使联系人中id为1的记录,不再级联客户<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo</span><span class="params">()</span></span>&#123;</div><div class="line">	Session session = HibernateUtils.OpenSession();</div><div class="line">	Transaction tx = session.beginTransaction();</div><div class="line">	</div><div class="line">	<span class="comment">//获得id为1的联系人对象</span></div><div class="line">	LinkMan lm = session.get(LinkMan.class, <span class="number">1L</span>);</div><div class="line">	<span class="comment">//表达关系</span></div><div class="line">	lm.setCustomer(<span class="keyword">null</span>);</div><div class="line"></div><div class="line">	</div><div class="line">	tx.commit();</div><div class="line">	session.close();</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><em>修改关系</em>:使联系人中id为1的记录,级联客户id为1的客户<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo</span><span class="params">()</span></span>&#123;</div><div class="line">	Session session = HibernateUtils.OpenSession();</div><div class="line">	Transaction tx = session.beginTransaction();</div><div class="line">	</div><div class="line">	<span class="comment">//获得id为1的联系人对象</span></div><div class="line">	LinkMan lm = session.get(LinkMan.class, <span class="number">3L</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//获得id为1的客户对象</span></div><div class="line">	<span class="comment">//方式1:先查询出所属的客户</span></div><div class="line">	<span class="comment">//Customer customer = session.get(Customer.class, 1L);</span></div><div class="line">	<span class="comment">//方式2:自己创建客户,收到设置oid</span></div><div class="line">	Customer customer = <span class="keyword">new</span> Customer();</div><div class="line">	customer.setCust_id(<span class="number">1L</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//设置关系</span></div><div class="line">	lm.setCustomer(customer);</div><div class="line"></div><div class="line">	</div><div class="line">	tx.commit();</div><div class="line">	session.close();</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><em>查询管理</em>:<br>1.通过联系人查询所属客户<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo</span><span class="params">()</span></span>&#123;</div><div class="line">	Session session = HibernateUtils.OpenSession();</div><div class="line">	Transaction tx = session.beginTransaction();</div><div class="line">	</div><div class="line">	<span class="comment">//获得id为1的联系人对象</span></div><div class="line">	LinkMan lm = session.get(LinkMan.class, <span class="number">3L</span>);</div><div class="line">	</div><div class="line">	System.out.println(lm.getCustomer());</div><div class="line"></div><div class="line">	</div><div class="line">	tx.commit();</div><div class="line">	session.close();</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.通过客户查询所属联系人<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo</span><span class="params">()</span></span>&#123;</div><div class="line">	Session session = HibernateUtils.OpenSession();</div><div class="line">	Transaction tx = session.beginTransaction();</div><div class="line">	</div><div class="line">	<span class="comment">//获得id为1的客户对象</span></div><div class="line">	Customer customer = session.get(Customer.class, <span class="number">1L</span>);</div><div class="line"></div><div class="line">	System.out.println(customer.getLinkMen());<span class="comment">//需要在LinkMan中重写ToString()</span></div><div class="line"></div><div class="line">	</div><div class="line">	tx.commit();</div><div class="line">	session.close();</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><h4 id="ORM对象关系映射-1"><a href="#ORM对象关系映射-1" class="headerlink" title="ORM对象关系映射"></a>ORM对象关系映射</h4><p><strong>R 关系数据库</strong><br>用户表对应角色表,一个用户可以对应多个角色,一个角色也可以对应多个用户,所以是多对多的关系<br><img src="http://oj3s07yy0.bkt.clouddn.com/blog/20170512/195911717.png" alt="mark"><br><strong>O 对象</strong><br><img src="http://oj3s07yy0.bkt.clouddn.com/blog/20170512/200901955.png" alt="mark"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//用户实体类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Long user_id;</div><div class="line">	<span class="keyword">private</span> String user_code;</div><div class="line">	<span class="keyword">private</span> String user_name;</div><div class="line">	<span class="keyword">private</span> String user_password;</div><div class="line">	<span class="keyword">private</span> Character user_state;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Set&lt;Role&gt; roles = <span class="keyword">new</span> HashSet&lt;Role&gt;();</div><div class="line">	</div><div class="line">	get/set...</div><div class="line">&#125;</div><div class="line"><span class="comment">//角色实体类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Long role_id;</div><div class="line">	<span class="keyword">private</span> String role_name;</div><div class="line">	<span class="keyword">private</span> String role_memo;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Set&lt;User&gt; users = <span class="keyword">new</span> HashSet&lt;User&gt;();</div><div class="line">	</div><div class="line">	get/set...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>M 映射</strong><br>分别在两个映射文件中添加set标签:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"当前实体类中的set集合的属性名"</span> <span class="attr">table</span>=<span class="string">"中间表的表名"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"当前表在中间表的外键名"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"对方持久化类的全限定名"</span> <span class="attr">column</span> =<span class="string">"对方表在中间表的外键名"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>User实体对应的映射配置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roles"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span>   &gt;</span></div><div class="line">	<span class="comment">&lt;!-- 别人引用"我"的外键列名 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"user_id"</span> &gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 表达集合是多对多关系</span></div><div class="line">		class属性:表达我与谁是多对多</div><div class="line">		column属性:表达另外一个外键列名</div><div class="line">	 --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"Role"</span> <span class="attr">column</span>=<span class="string">"role_id"</span> &gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Role实体对应的映射配置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"users"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>   &gt;</span></div><div class="line">	<span class="comment">&lt;!-- 别人引用"我"的外键列名 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"role_id"</span> &gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"User"</span> <span class="attr">column</span>=<span class="string">"user_id"</span> &gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="多对多中的操作"><a href="#多对多中的操作" class="headerlink" title="多对多中的操作"></a>多对多中的操作</h4><h5 id="级联操作-1"><a href="#级联操作-1" class="headerlink" title="级联操作"></a>级联操作</h5><p>道理与一对多一样,在set标签中添加cascade属性即可,级联删除不建议使用.</p>
<h5 id="inverse-1"><a href="#inverse-1" class="headerlink" title="inverse"></a>inverse</h5><p>背景:保存用户以及所属角色时,如果两方关系都表达,在保存时会抛出中间表主键重复异常.两方关系都描述,hibernate会维护两次关系.两次关系维护都是向中间表插入记录.关系描述重复,所以插入记录重复.<br>解决方案1:书写代码时,只书写维护一方关系的代码<br>解决方案2:在某一方配置中.加入inverse属性放弃维护关系<br>在多对多关系中一般需要挑选一方放弃关系维护,避免中间表数据录入重复.技术层面讲,选择任何一方放弃都可以.但是在业务上,关系的维护方不能放弃.<br>关系的维护方举例:<br>(1)老师-学生: 需要先有老师,学生才能选择是哪个老师的学生.关系的维护方是学生,所以老师放弃.<br>(2)商品-订单: 需要先有商品,才能下订单.关系的维护方是订单,商品放弃.<br>(3)用户-角色: 需要先有用户,才能决定他是什么角色,所以用户维护关系,角色放弃<br>综上所述:在角色实体的映射配置的set标签中,添加inverse=”true”<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo</span><span class="params">()</span></span>&#123;</div><div class="line">	Session session = HibernateUtils.OpenSession();</div><div class="line">	<span class="comment">//开启事务</span></div><div class="line">	Transaction tx = session.beginTransaction();</div><div class="line">	<span class="comment">//操作------------------------</span></div><div class="line">	<span class="comment">//创建用户</span></div><div class="line">	User user1 = <span class="keyword">new</span> User();</div><div class="line">	User user2 = <span class="keyword">new</span> User();</div><div class="line">	user1.setUser_name(<span class="string">"张三"</span>);</div><div class="line">	user2.setUser_name(<span class="string">"李四"</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//创建角色</span></div><div class="line">	Role role1 = <span class="keyword">new</span> Role();</div><div class="line">	Role role2 = <span class="keyword">new</span> Role();</div><div class="line">	role1.setRole_name(<span class="string">"程序员"</span>);</div><div class="line">	role2.setRole_name(<span class="string">"架构师"</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//表达关系</span></div><div class="line">	<span class="comment">//解决方案1:下面两组只写一组</span></div><div class="line">	<span class="comment">//解决方案2:两组都写,在角色实体的映射配置的set标签中,添加inverse="true"</span></div><div class="line">	<span class="comment">//1</span></div><div class="line">	user1.getRoles().add(role1);<span class="comment">//向中间表插入1-1</span></div><div class="line">	user1.getRoles().add(role2);</div><div class="line">	user2.getRoles().add(role1);</div><div class="line">	user2.getRoles().add(role2);</div><div class="line">	<span class="comment">//2</span></div><div class="line">	role1.getUsers().add(user1);<span class="comment">//向中间表插入1-1</span></div><div class="line">	role1.getUsers().add(user2);</div><div class="line">	role2.getUsers().add(user1);</div><div class="line">	role2.getUsers().add(user2);</div><div class="line">	</div><div class="line">	<span class="comment">//4.保存</span></div><div class="line">	session.save(user1);</div><div class="line">	session.save(user2);</div><div class="line">	session.save(role1);</div><div class="line">	session.save(role2);</div><div class="line">	<span class="comment">//---------------------------</span></div><div class="line">	<span class="comment">//提交事务</span></div><div class="line">	tx.commit();</div><div class="line">	<span class="comment">//释放资源</span></div><div class="line">	session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="其他操作-1"><a href="#其他操作-1" class="headerlink" title="其他操作"></a>其他操作</h5><p><em>移除用户的角色</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="comment">//移除用户中id为1的记录的角色中id为2的角色</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</div><div class="line">	Session session = HibernateUtils.OpenSession();</div><div class="line">	Transaction tx = session.beginTransaction();</div><div class="line">	<span class="comment">//操作-----------------------</span></div><div class="line">	User user = session.get(User.class, <span class="number">1L</span>);</div><div class="line">	<span class="comment">//方案1:可以中间表中直接删除用户id为1对应的角色id为2的这条记录</span></div><div class="line">	Role role = session.get(Role.class, <span class="number">2L</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//方案2:需要在Role实体类中重写hashCode()和equal(),才能删除成功</span></div><div class="line">	<span class="comment">/*Role role = new Role();</span></div><div class="line">	role.setRole_id(2L);*/</div><div class="line">	</div><div class="line">	user.getRoles().remove(role);</div><div class="line">	<span class="comment">//---------------------------</span></div><div class="line">	tx.commit();</div><div class="line">	session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><em>修改用户的角色</em>:方案1和方案2都可以,不需要写hashCode()和equals()<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="comment">//修改用户中id为1的记录的角色为角色中id为2的角色</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span></span>&#123;</div><div class="line">		Session session = HibernateUtils.OpenSession();</div><div class="line">		Transaction tx = session.beginTransaction();</div><div class="line">		<span class="comment">//操作-----------------------</span></div><div class="line">		User user = session.get(User.class, <span class="number">1L</span>);</div><div class="line">		<span class="comment">//方案1:</span></div><div class="line">		<span class="comment">//Role role = session.get(Role.class, 2L);</span></div><div class="line">		</div><div class="line">		<span class="comment">//方案2:</span></div><div class="line">		Role role = <span class="keyword">new</span> Role();</div><div class="line">		role.setRole_id(<span class="number">2L</span>);</div><div class="line">		</div><div class="line">		user.getRoles().add(role);</div><div class="line">		<span class="comment">//---------------------------</span></div><div class="line">		tx.commit();</div><div class="line">		session.close();</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p><em>查询用户的角色</em>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span></span>&#123;</div><div class="line">	Session session = HibernateUtils.OpenSession();</div><div class="line">	Transaction tx = session.beginTransaction();</div><div class="line">	<span class="comment">//操作-----------------------</span></div><div class="line">	User user = session.get(User.class, <span class="number">1L</span>);</div><div class="line">	</div><div class="line">	System.out.println(user.getRoles());</div><div class="line">	<span class="comment">//---------------------------</span></div><div class="line">	tx.commit();</div><div class="line">	session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/SSH/" rel="tag">#SSH</a>
          
            <a href="/tags/hibernate/" rel="tag">#hibernate</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/04/12/JDBC事务/" rel="next" title="JDBC事务">
                <i class="fa fa-chevron-left"></i> JDBC事务
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/05/09/hibernate/"
           data-title="hibernate" data-url="https://geekhoon.github.io/2017/05/09/hibernate/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="geekhoon" />
          <p class="site-author-name" itemprop="name">geekhoon</p>
          <p class="site-description motion-element" itemprop="description">技术博客</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">40</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/geekhoon" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/hlc1018" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              技术大牛
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.devtang.com" title="唐巧" target="_blank">唐巧</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.onevcat.com" title="喵神" target="_blank">喵神</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jianshu.com/users/b82d2721ba07/latest_articles" title="叶孤城" target="_blank">叶孤城</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://tutuge.me" title="土土哥" target="_blank">土土哥</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.sunnyxx.com" title="sunny" target="_blank">sunny</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.ibireme.com" title="lbireme" target="_blank">lbireme</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://kittenyang.com" title="kittenyang" target="_blank">kittenyang</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hibernate框架搭建"><span class="nav-number">2.</span> <span class="nav-text">hibernate框架搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建项目"><span class="nav-number">2.1.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导jar包"><span class="nav-number">2.2.</span> <span class="nav-text">导jar包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建数据库与表"><span class="nav-number">2.3.</span> <span class="nav-text">创建数据库与表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建对应的实体类JavaBean"><span class="nav-number">2.4.</span> <span class="nav-text">创建对应的实体类JavaBean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建映射配置文件"><span class="nav-number">2.5.</span> <span class="nav-text">创建映射配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建hibernate主配置"><span class="nav-number">2.6.</span> <span class="nav-text">创建hibernate主配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试类"><span class="nav-number">2.7.</span> <span class="nav-text">测试类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API"><span class="nav-number">3.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuration"><span class="nav-number">3.1.</span> <span class="nav-text">Configuration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SessionFactory"><span class="nav-number">3.2.</span> <span class="nav-text">SessionFactory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session"><span class="nav-number">3.3.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Transaction"><span class="nav-number">3.4.</span> <span class="nav-text">Transaction</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HibernateUtils工具类"><span class="nav-number">4.</span> <span class="nav-text">HibernateUtils工具类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#持久化类"><span class="nav-number">5.</span> <span class="nav-text">持久化类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概念"><span class="nav-number">5.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#作用"><span class="nav-number">5.2.</span> <span class="nav-text">作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写规则"><span class="nav-number">5.3.</span> <span class="nav-text">编写规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#持久化类的状态"><span class="nav-number">5.4.</span> <span class="nav-text">持久化类的状态</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#三种状态及转化"><span class="nav-number">5.4.1.</span> <span class="nav-text">三种状态及转化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#saveOrUpdate方法"><span class="nav-number">5.5.</span> <span class="nav-text">saveOrUpdate方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主键生成策略"><span class="nav-number">6.</span> <span class="nav-text">主键生成策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一级缓存"><span class="nav-number">7.</span> <span class="nav-text">一级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概念-1"><span class="nav-number">7.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#作用-1"><span class="nav-number">7.2.</span> <span class="nav-text">作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#流程"><span class="nav-number">7.3.</span> <span class="nav-text">流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#特点"><span class="nav-number">7.4.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#快照"><span class="nav-number">7.5.</span> <span class="nav-text">快照</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事务管理"><span class="nav-number">8.</span> <span class="nav-text">事务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#项目中事务管理"><span class="nav-number">8.1.</span> <span class="nav-text">项目中事务管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hibernate查询API"><span class="nav-number">9.</span> <span class="nav-text">hibernate查询API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HQL查询"><span class="nav-number">9.1.</span> <span class="nav-text">HQL查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Criteria查询-QBC查询"><span class="nav-number">9.2.</span> <span class="nav-text">Criteria查询(QBC查询)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原生SQL查询"><span class="nav-number">9.3.</span> <span class="nav-text">原生SQL查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实体关系"><span class="nav-number">10.</span> <span class="nav-text">实体关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一对多-多对一"><span class="nav-number">10.1.</span> <span class="nav-text">一对多|多对一</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ORM对象关系映射"><span class="nav-number">10.1.1.</span> <span class="nav-text">ORM对象关系映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一对多中的操作"><span class="nav-number">10.1.2.</span> <span class="nav-text">一对多中的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#级联操作"><span class="nav-number">10.1.2.1.</span> <span class="nav-text">级联操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#inverse"><span class="nav-number">10.1.2.2.</span> <span class="nav-text">inverse</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#其他操作"><span class="nav-number">10.1.2.3.</span> <span class="nav-text">其他操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多对多"><span class="nav-number">10.2.</span> <span class="nav-text">多对多</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ORM对象关系映射-1"><span class="nav-number">10.2.1.</span> <span class="nav-text">ORM对象关系映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多对多中的操作"><span class="nav-number">10.2.2.</span> <span class="nav-text">多对多中的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#级联操作-1"><span class="nav-number">10.2.2.1.</span> <span class="nav-text">级联操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#inverse-1"><span class="nav-number">10.2.2.2.</span> <span class="nav-text">inverse</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#其他操作-1"><span class="nav-number">10.2.2.3.</span> <span class="nav-text">其他操作</span></a></li></ol></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">geekhoon</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"hou912115764"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementById('footer')
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("zFAH2d3IYRTUyQcRt5OsVBXQ-gzGzoHsz", "ziVrxCvGd6X65NWAtcpbi5Ng");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
